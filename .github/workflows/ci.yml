# CI/CD ç¤ºä¾‹é…ç½®æ–‡ä»¶
# è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†è‡ªåŠ¨åŒ–æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹

name: CI/CD Pipeline

# è§¦å‘æ¡ä»¶ï¼šå½“æ¨é€ä»£ç æˆ–åˆ›å»º Pull Request æ—¶
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # ä»»åŠ¡1ï¼šæµ‹è¯•
  test:
    runs-on: ubuntu-latest
    
    steps:
    # æ­¥éª¤1ï¼šæ£€å‡ºä»£ç 
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    # æ­¥éª¤2ï¼šè®¾ç½® Python ç¯å¢ƒ
    - name: è®¾ç½® Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
    
    # æ­¥éª¤3ï¼šå®‰è£…ä¾èµ–
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install pytest flake8
    
    # æ­¥éª¤4ï¼šä»£ç é£æ ¼æ£€æŸ¥
    - name: ä»£ç é£æ ¼æ£€æŸ¥
      run: |
        flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
    
    # æ­¥éª¤5ï¼šè¿è¡Œæµ‹è¯•
    - name: è¿è¡Œæµ‹è¯•
      run: |
        python test.py
    
  # ä»»åŠ¡2ï¼šéƒ¨ç½²ï¼ˆä»…åœ¨æµ‹è¯•é€šè¿‡åï¼‰
  deploy:
    needs: test  # ä¾èµ–äº test ä»»åŠ¡
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'  # åªåœ¨ main åˆ†æ”¯éƒ¨ç½²
    
    steps:
    - name: éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
      run: |
        echo "ğŸš€ éƒ¨ç½²æˆåŠŸï¼"
        # è¿™é‡Œå¯ä»¥æ·»åŠ å®é™…çš„éƒ¨ç½²å‘½ä»¤
